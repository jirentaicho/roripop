__NUXT_JSONP__("/post/1265", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){return {data:[{post:{id:1265,date:l,date_gmt:m,guid:{rendered:"https:\u002F\u002Fvolkruss.com\u002F?p=1265"},modified:l,modified_gmt:m,slug:"%e5%a4%9c%e3%81%ae%e5%ba%97%e5%b0%82%e9%96%80%e3%81%ae%e3%83%af%e3%83%bc%e3%83%89%e3%83%97%e3%83%ac%e3%82%b9%e3%81%ae%e3%83%97%e3%83%a9%e3%82%b0%e3%82%a4%e3%83%b3%e3%82%92%e4%bd%9c%e3%81%a3%e3%81%9f",status:"publish",type:"post",link:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002F2021\u002F06\u002F08\u002F%e5%a4%9c%e3%81%ae%e5%ba%97%e5%b0%82%e9%96%80%e3%81%ae%e3%83%af%e3%83%bc%e3%83%89%e3%83%97%e3%83%ac%e3%82%b9%e3%81%ae%e3%83%97%e3%83%a9%e3%82%b0%e3%82%a4%e3%83%b3%e3%82%92%e4%bd%9c%e3%81%a3%e3%81%9f\u002F",title:{rendered:"夜の店専門のワードプレスのプラグインを作ったお話"},content:{rendered:"\n\u003Cfigure class=\"wp-block-embed is-type-rich is-provider-twitter wp-block-embed-twitter\"\u003E\u003Cdiv class=\"wp-block-embed__wrapper\"\u003E\n\u003Cblockquote class=\"twitter-tweet\" data-width=\"550\" data-dnt=\"true\"\u003E\u003Cp lang=\"ja\" dir=\"ltr\"\u003E風俗店とかキャバクラとかホストとかで使える、夜のお店専門のワードプレスのプラグインが完成したのだ！\u003Ca href=\"https:\u002F\u002Ft.co\u002F17NSse9OwS\"\u003Ehttps:\u002F\u002Ft.co\u002F17NSse9OwS\u003C\u002Fa\u003E\u003C\u002Fp\u003E&mdash; 超電磁砲 (@keisukesiratori) \u003Ca href=\"https:\u002F\u002Ftwitter.com\u002Fkeisukesiratori\u002Fstatus\u002F1402116665555386374?ref_src=twsrc%5Etfw\"\u003EJune 8, 2021\u003C\u002Fa\u003E\u003C\u002Fblockquote\u003E\u003Cscript async src=\"https:\u002F\u002Fplatform.twitter.com\u002Fwidgets.js\" charset=\"utf-8\"\u003E\u003C\u002Fscript\u003E\n\u003C\u002Fdiv\u003E\u003C\u002Ffigure\u003E\n\n\n\u003Cp\u003E最近、トゥイッターをはじめました。登録はしてたんですが、アカウント忘れてて、ようやく見つけました。\u003C\u002Fp\u003E\n\n\n\u003Cp\u003E今回は、こんないかがわしいトゥイートを発見しました。\u003Cbr \u002F\u003Eなんと、夜のお店のテーマに使えるような、テーマ拡張型のワードプレスのプラグインを作成しました。とのことです。\u003C\u002Fp\u003E\n\n\n\u003Cp\u003E割と必要な機能は揃ってると思います、あとは改造も楽にできそうな予感がしてます。（プロフィール画像を追加したいとか）\u003C\u002Fp\u003E\n\n\n\u003Cp\u003E今回はプラグインの紹介と作りについて少し記載します。\u003C\u002Fp\u003E\n\n\n\u003Ch2\u003E作ったプラグインとは\u003C\u002Fh2\u003E\n\n\n\u003Cp\u003ESuperNightPluginというプラグインを作りました。\u003Cbr \u002F\u003E夜のお店で使えるプラグインになります。\u003C\u002Fp\u003E\n\n\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fjirentaicho\u002FSuperNightPlugin\"\u003Ehttps:\u002F\u002Fgithub.com\u003C\u002Fa\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fjirentaicho\u002FSuperNightPlugin\" target=\"_blank\" rel=\"noreferrer noopener\"\u003E\u002F\u003C\u002Fa\u003E\u003Ca href=\"https:\u002F\u002Fgithub.com\u002Fjirentaicho\u002FSuperNightPlugin\"\u003Ejirentaicho\u002FSuperNightPlugin\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n\n\n\u003Cp\u003Eテーマ拡張型プラグインという言葉があるかわかりませんが、テーマ作成を拡張するようなプラグインになります。なので、ある程度テーマを作れる人が使用することを想定しています。\u003C\u002Fp\u003E\n\n\n\u003Cp\u003E機能としては、こんな感じです。\u003C\u002Fp\u003E\n\n\n\u003Cul\u003E\u003Cli\u003Eキャストの管理機能\u003C\u002Fli\u003E\u003Cli\u003Eキャストのスケジュール管理機能\u003C\u002Fli\u003E\u003Cli\u003Eメール投稿機能（別途Postieプラグインを利用します）\u003C\u002Fli\u003E\u003Cli\u003EAPIの提供\u003C\u002Fli\u003E\u003C\u002Ful\u003E\n\n\n\u003Ch3\u003Eキャストの管理機能\u003C\u002Fh3\u003E\n\n\n\u003Cp\u003Eいわゆるカスタム投稿タイプってやつでキャストを追加しています。\u003Cbr \u002F\u003E在籍するキャストの数だけ登録してください。\u003C\u002Fp\u003E\n\n\n\u003Cp\u003Eまた、メールアドレスの入力欄があり、Postieというプラグインを有効化している場合は、自動的にPostie側のプラグインにも許可メールアドレスが登録されるようになっています。\u003C\u002Fp\u003E\n\n\n\u003Cp\u003EPostieはメールアドレスさえあれば、メール投稿が可能なプラグインですので、わざわざワードプレスのユーザーを作る手間を省いています。\u003C\u002Fp\u003E\n\n\n\u003Ch2\u003Eキャストのスケジュール管理機能\u003C\u002Fh2\u003E\n\n\n\u003Cp\u003Eスケジュール管理画面を追加しました。\u003Cbr \u002F\u003Eこれはキャストごとに保持しているmyscheduleというカスタムフィールドに値を設定します。\u003C\u002Fp\u003E\n\n\n\u003Cp\u003Eカスタムフィールドの中に配列を用意することで、別のテーブルを用意することなくスケジュール情報を管理しています。\u003C\u002Fp\u003E\n\n\n\u003Cp\u003E業務とかでのテーブル設計ではこのような書き方はあまりしませんが、ワードプレスの他のプラグインを見ると、この手法はよくあるテクニックのようで、Postieでも使われていました。\u003C\u002Fp\u003E\n\n\n\u003Cp\u003Eいちいち更新処理が入るたびに画面が更新されるのが面倒なのでAjaxを使いました。\u003Cbr \u002F\u003Ewordpressではajax通信ではwp_ajax_関数名というアクションフックを利用することで実装できます。\u003C\u002Fp\u003E\n\n\n\u003Cpre class=\"wp-block-code\"\u003E\u003Ccode\u003E\u002F\u002Fアクションフック\nadd_action('wp_ajax_register_ajax_data', array($this,'register_ajax_data'));\n\u002F\u002Fその内容（一部）\npublic function register_ajax_data(){\n        $nonce = $_POST&#91;\"nonce\"];\n        $post_id = $_POST&#91;\"post_id\"];\n        if(wp_verify_nonce($nonce,'get-schedule-nonce')){\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\u003Cp\u003EどうやってnonceをAjaxのパラメータに渡すのかというと、jsファイルを読み込ませる際に設定できます（詳しくはgithubにソースがあります）\u003C\u002Fp\u003E\n\n\n\u003Cpre class=\"wp-block-code\"\u003E\u003Ccode\u003E        wp_localize_script('myscript', 'ex_values', array(\n            'admin_url' =\u003E esc_url(admin_url( 'admin-ajax.php', __FILE__ )),\n            'nonce' =\u003E wp_create_nonce('get-schedule-nonce'),\n        )); \u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\u003Cp\u003Ejs側ではURLSearchParamsを利用します。\u003C\u002Fp\u003E\n\n\n\u003Cpre class=\"wp-block-code\"\u003E\u003Ccode\u003E    let param = new URLSearchParams();\n    &#91; ... inputs].forEach(input =\u003E param.append(input.name,input.value) )\n    param.append(\"action\", 'register_ajax_data')\n    param.append(\"nonce\", ex_values.nonce)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\n\n\n\u003Ch2\u003Eメール投稿機能（別途Postieプラグインを利用します）\u003C\u002Fh2\u003E\n\n\n\u003Cp\u003Eメール投稿機能といえば、キャストのブログのようなものです。\u003Cbr \u002F\u003Eワードプレスにはユーザーを追加する機能があるので、キャストごとにユーザーを追加してキャストがそのユーザー情報でログインして投稿すれば、問題なくそれが実現できます。\u003C\u002Fp\u003E\n\n\n\u003Cp\u003Eでも、それって面倒くさいです。キャスト側もいちいちログインしないといけないのは面倒です。\u003C\u002Fp\u003E\n\n\n\u003Cp\u003Eそこで、複数のユーザーがメール投稿できるプラグインPostieを使うことにしました。\u003Cbr \u002F\u003Eそうすれば実装できる気がしない、メールの設定処理も全てお任せできます。\u003C\u002Fp\u003E\n\n\n\u003Cp\u003Eなので、私がやったことは、キャストのメールアドレスとpostieのメールアドレスを強制的に紐づけることだけです。\u003C\u002Fp\u003E\n\n\n\u003Cp\u003Eこうすることで、キャストごとにメールでブログの投稿ができようになります。\u003C\u002Fp\u003E\n\n\n\u003Ch2\u003EAPIの提供\u003C\u002Fh2\u003E\n\n\n\u003Cp\u003E必要な機能は作っても、テーマ側でどうやって利用するのか？\u003Cbr \u002F\u003Eまさか実装を全て読むなんて面倒なことをさせてはいけないので、APIを用意しました。\u003C\u002Fp\u003E\n\n\n\u003Cp\u003Eテーマ作成者は、globalに用意されたAPIを利用するだけで、テーマにプラグインの機能を取り込めるようにしました。\u003C\u002Fp\u003E\n\n\n\u003Ch2\u003E感想\u003C\u002Fh2\u003E\n\n\n\u003Cp\u003Eプラグイン化しておくことで、お店のホームページを作るってなったときに、0から用意する必要がなくなるので便利ですねって思いました。\u003C\u002Fp\u003E\n\n\n\u003Cp\u003Eあと、正直ワードプレスってあんまり詳しくないんで、結構調べながらやったんですが、カスタム投稿タイプはこのプラグインを使え！みたいな記事が多い印象。\u003Cbr \u002F\u003Eいや、そうじゃない。。。と思いながらも、プログラマーでなくても機能拡張できるプラグインってのはすごいなと思いました。\u003C\u002Fp\u003E\n\n\n\u003Cp\u003Eあと、PHPという言語は難しいな。と思いました。\u003C\u002Fp\u003E\n",protected:j},excerpt:{rendered:"\u003Cp\u003E最近、トゥイッターをはじめました。登録はしてたんですが、アカウント忘れてて、ようやく見つけました。 今回は、こんないかがわしいトゥイートを発見しました。なんと、夜のお店のテーマに使えるような、テーマ拡張型のワードプレスの&hellip; \u003Ca class=\"more-link\" href=\"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002F2021\u002F06\u002F08\u002F%e5%a4%9c%e3%81%ae%e5%ba%97%e5%b0%82%e9%96%80%e3%81%ae%e3%83%af%e3%83%bc%e3%83%89%e3%83%97%e3%83%ac%e3%82%b9%e3%81%ae%e3%83%97%e3%83%a9%e3%82%b0%e3%82%a4%e3%83%b3%e3%82%92%e4%bd%9c%e3%81%a3%e3%81%9f\u002F\"\u003E続きを読む \u003Cspan class=\"screen-reader-text\"\u003E夜の店専門のワードプレスのプラグインを作ったお話\u003C\u002Fspan\u003E\u003C\u002Fa\u003E\u003C\u002Fp\u003E\n",protected:j},author:k,featured_media:b,comment_status:n,ping_status:n,sticky:j,template:c,format:"standard",meta:[],categories:[o],tags:[56],_links:{self:[{href:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fwp-json\u002Fwp\u002Fv2\u002Fposts\u002F1265"}],collection:[{href:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fwp-json\u002Fwp\u002Fv2\u002Fposts"}],about:[{href:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fwp-json\u002Fwp\u002Fv2\u002Ftypes\u002Fpost"}],author:[{embeddable:a,href:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fwp-json\u002Fwp\u002Fv2\u002Fusers\u002F1"}],replies:[{embeddable:a,href:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fwp-json\u002Fwp\u002Fv2\u002Fcomments?post=1265"}],"version-history":[{count:b,href:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fwp-json\u002Fwp\u002Fv2\u002Fposts\u002F1265\u002Frevisions"}],"wp:attachment":[{href:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fwp-json\u002Fwp\u002Fv2\u002Fmedia?parent=1265"}],"wp:term":[{taxonomy:d,embeddable:a,href:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fwp-json\u002Fwp\u002Fv2\u002Fcategories?post=1265"},{taxonomy:"post_tag",embeddable:a,href:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fwp-json\u002Fwp\u002Fv2\u002Ftags?post=1265"}],curies:[{name:e,href:f,templated:a}]}}}],fetch:{"0":{categories:{categories:[{id:2,count:i,description:c,link:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fcategory\u002Fblender\u002F",name:"Blender",slug:"blender",taxonomy:d,parent:b,meta:[],_links:{self:[{href:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fwp-json\u002Fwp\u002Fv2\u002Fcategories\u002F2"}],collection:[{href:g}],about:[{href:h}],"wp:post_type":[{href:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fwp-json\u002Fwp\u002Fv2\u002Fposts?categories=2"}],curies:[{name:e,href:f,templated:a}]}},{id:p,count:i,description:c,link:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fcategory\u002Fdocker\u002F",name:"Docker",slug:"docker",taxonomy:d,parent:b,meta:[],_links:{self:[{href:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fwp-json\u002Fwp\u002Fv2\u002Fcategories\u002F3"}],collection:[{href:g}],about:[{href:h}],"wp:post_type":[{href:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fwp-json\u002Fwp\u002Fv2\u002Fposts?categories=3"}],curies:[{name:e,href:f,templated:a}]}},{id:77,count:k,description:c,link:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fcategory\u002Fgulp\u002F",name:q,slug:q,taxonomy:d,parent:b,meta:[],_links:{self:[{href:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fwp-json\u002Fwp\u002Fv2\u002Fcategories\u002F77"}],collection:[{href:g}],about:[{href:h}],"wp:post_type":[{href:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fwp-json\u002Fwp\u002Fv2\u002Fposts?categories=77"}],curies:[{name:e,href:f,templated:a}]}},{id:i,count:r,description:c,link:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fcategory\u002Fjava\u002F",name:"Java",slug:"java",taxonomy:d,parent:b,meta:[],_links:{self:[{href:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fwp-json\u002Fwp\u002Fv2\u002Fcategories\u002F4"}],collection:[{href:g}],about:[{href:h}],"wp:post_type":[{href:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fwp-json\u002Fwp\u002Fv2\u002Fposts?categories=4"}],curies:[{name:e,href:f,templated:a}]}},{id:s,count:i,description:c,link:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fcategory\u002Fjavascript\u002F",name:"JavaScript",slug:"javascript",taxonomy:d,parent:b,meta:[],_links:{self:[{href:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fwp-json\u002Fwp\u002Fv2\u002Fcategories\u002F5"}],collection:[{href:g}],about:[{href:h}],"wp:post_type":[{href:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fwp-json\u002Fwp\u002Fv2\u002Fposts?categories=5"}],curies:[{name:e,href:f,templated:a}]}},{id:r,count:40,description:c,link:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fcategory\u002Funity\u002F",name:"Unity",slug:"unity",taxonomy:d,parent:b,meta:[],_links:{self:[{href:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fwp-json\u002Fwp\u002Fv2\u002Fcategories\u002F6"}],collection:[{href:g}],about:[{href:h}],"wp:post_type":[{href:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fwp-json\u002Fwp\u002Fv2\u002Fposts?categories=6"}],curies:[{name:e,href:f,templated:a}]}},{id:7,count:t,description:c,link:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fcategory\u002Fvue-js\u002F",name:"Vue.js",slug:"vue-js",taxonomy:d,parent:b,meta:[],_links:{self:[{href:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fwp-json\u002Fwp\u002Fv2\u002Fcategories\u002F7"}],collection:[{href:g}],about:[{href:h}],"wp:post_type":[{href:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fwp-json\u002Fwp\u002Fv2\u002Fposts?categories=7"}],curies:[{name:e,href:f,templated:a}]}},{id:o,count:s,description:c,link:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fcategory\u002Fwordpress\u002F",name:"WordPress",slug:"wordpress",taxonomy:d,parent:b,meta:[],_links:{self:[{href:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fwp-json\u002Fwp\u002Fv2\u002Fcategories\u002F8"}],collection:[{href:g}],about:[{href:h}],"wp:post_type":[{href:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fwp-json\u002Fwp\u002Fv2\u002Fposts?categories=8"}],curies:[{name:e,href:f,templated:a}]}},{id:t,count:p,description:c,link:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fcategory\u002F%e3%81%9d%e3%81%ae%e4%bb%96\u002F",name:"その他",slug:"%e3%81%9d%e3%81%ae%e4%bb%96",taxonomy:d,parent:b,meta:[],_links:{self:[{href:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fwp-json\u002Fwp\u002Fv2\u002Fcategories\u002F9"}],collection:[{href:g}],about:[{href:h}],"wp:post_type":[{href:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fwp-json\u002Fwp\u002Fv2\u002Fposts?categories=9"}],curies:[{name:e,href:f,templated:a}]}},{id:k,count:b,description:c,link:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fcategory\u002Funcategorized\u002F",name:"未分類",slug:"uncategorized",taxonomy:d,parent:b,meta:[],_links:{self:[{href:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fwp-json\u002Fwp\u002Fv2\u002Fcategories\u002F1"}],collection:[{href:g}],about:[{href:h}],"wp:post_type":[{href:"https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fwp-json\u002Fwp\u002Fv2\u002Fposts?categories=1"}],curies:[{name:e,href:f,templated:a}]}}]}}},mutations:void 0}}(true,0,"","category","wp","https:\u002F\u002Fapi.w.org\u002F{rel}","https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fwp-json\u002Fwp\u002Fv2\u002Fcategories","https:\u002F\u002Fwww.volkruss.com\u002Fnuxt\u002Fapi\u002Fwp-json\u002Fwp\u002Fv2\u002Ftaxonomies\u002Fcategory",4,false,1,"2021-06-08T22:19:14","2021-06-08T13:19:14","open",8,3,"gulp",6,5,9)));